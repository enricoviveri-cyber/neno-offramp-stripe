<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NENO → Euro (Off-Ramp Istantaneo)</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body { font-family: Arial; background: #1e3c72; color: white; text-align: center; padding: 40px; margin: 0; min-height: 100vh; }
    .container { max-width: 500px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; }
    input, button { width: 100%; padding: 15px; margin: 15px 0; border: none; border-radius: 12px; font-size: 18px; }
    button { background: #00ff88; color: black; font-weight: bold; cursor: pointer; }
    .wallet { background: #000; color: #0f0; padding: 15px; border-radius: 10px; margin: 20px 0; word-break: break-all; font-family: monospace; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Vendi NENO → Ricevi Euro</h1>
    <p>Soldi sul tuo conto bancario in 1-2 giorni</p>
    <input type="number" id="amount" placeholder="Quanti NENO vuoi vendere?" min="10" step="0.01"/>
    <button onclick="sellNENO()">VENDI NENO</button>
    <div id="result"></div>
  </div>

  <script>
    async function sellNENO() {
      const amount = document.getElementById('amount').value;
      if (!amount || amount < 10) return alert("Minimo 10 NENO");

      // Prima crea account Connect + onboarding (devi avere già fatto KYC)
      const account = await fetch('/create-connect-account', { method: 'POST' }).then(r => r.json());

      const res = await fetch("/create-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tokenAmount: amount, stripeAccountId: account.id })
      });
      const data = await res.json();

      document.getElementById('result').innerHTML = `
        <div style="background:rgba(0,255,0,0.2);padding:20px;border-radius:15px;margin-top:20px;">
          <h3>Invia esattamente ${amount} NENO a:</h3>
          <div class="wallet">${data.wallet}</div>
          <p>Riceverai <strong>€${data.eurAmount}</strong> automaticamente</p>
          <p><small>Il sistema monitora in tempo reale</small></p>
        </div>
      `;
      navigator.clipboard.writeText(data.wallet);
    }
  </script>
</body>
</html>
